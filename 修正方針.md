# Excelアドイン「PDF/Excel出力フォーム」修正方針

## 問題の原因分析

### 1. マクロ一覧に表示されない原因

以下の要因が考えられます：

1. **アドインとして保存されている場合の制限**
   - Excelアドイン（.xlam）は、デフォルトでマクロ一覧に表示されないことがある
   - ただし、`Application.Run`で呼び出すことは可能

2. **Option Private Module の有無**
   - 現在のコードには`Option Private Module`は存在しない（確認済み）
   - もし存在する場合は、モジュール全体が非公開になるため削除が必要

3. **Public Sub の配置**
   - `PDF_エクスポート_フォーム表示()`は既に`Public Sub`として定義されている
   - 標準モジュール（`modPdfExport`）に配置されている

4. **アドイン名の指定**
   - `Application.Run "'アドイン名.xlam'!PDF_エクスポート_フォーム表示"`の形式で呼び出す必要がある
   - アドイン名は実ファイル名（拡張子含む）に合わせる

### 2. 対象ブックがアドイン自身になる問題

現在の`PDF_エクスポート_フォーム表示()`は`ActiveWorkbook`を直接使用しているため、以下の問題が発生する可能性があります：

- 他ブックから呼び出した場合、`ActiveWorkbook`がアドイン自身（ThisWorkbook）になる可能性がある
- アドイン自身を出力対象にしてしまうと、エラーが発生する

## 修正内容

### 1. targetWbを安全に決定する関数の追加

`GetTargetWorkbook()`関数を追加：
- `ActiveWorkbook`が`ThisWorkbook`（アドイン自身）の場合は、別のブックを選択
- `Workbooks`コレクションから、アドイン以外の最初のブックを返す
- ブックが見つからない場合は`Nothing`を返す

### 2. PDF_エクスポート_フォーム表示()の修正

- `GetTargetWorkbook()`を使用して安全に`targetWb`を決定
- `targetWb`が`Nothing`の場合はエラーメッセージを表示

### 3. Option Private Module の確認

- 現在のコードには存在しない（確認済み）
- もし存在する場合は削除が必要

### 4. 他ブックからの呼び出し方法

```vba
' アドイン名は実ファイル名に合わせる（例：PdfExport.xlam）
Application.Run "'PdfExport.xlam'!PDF_エクスポート_フォーム表示"
```

## 修正後の動作

1. 他ブックから`Application.Run`で呼び出せる
2. 対象ブックがアドイン自身になることを防ぐ
3. マクロ一覧に表示されなくても、`Application.Run`で確実に呼び出せる

