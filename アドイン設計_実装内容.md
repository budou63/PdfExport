# PdfExport.xlam アドイン設計 - 実装内容

## 概要

Excelアドイン「PdfExport.xlam」を正しいアドイン設計に整理し、Alt+F8のマクロ一覧に表示される入口マクロを追加しました。

## 実装内容

### 1. 新規モジュール：`modEntry`（標準モジュール）

**目的：** Alt+F8のマクロ一覧に表示される引数なしのPublic Subを配置

**追加内容：**

#### ① メイン入口マクロ
```vba
Public Sub PdfExport_起動()
    Call modPdfExport.PDF_エクスポート_フォーム表示
End Sub
```
- Alt+F8のマクロ一覧に表示される
- 既存の`PDF_エクスポート_フォーム表示()`を呼び出す

#### ② QAT用の短い名前マクロ
```vba
Public Sub PE()
    Call modPdfExport.PDF_エクスポート_フォーム表示
End Sub
```
- クイックアクセスツールバー（QAT）に登録しやすい短い名前
- 同じ機能を提供

#### ③ テスト・動作確認用マクロ
```vba
Public Sub PdfExport_テスト()
    Dim msg As String
    Dim addinName As String
    
    addinName = ThisWorkbook.Name
    msg = "PDF/Excel出力アドイン" & vbCrLf & vbCrLf & _
          "アドイン名: " & addinName & vbCrLf & _
          "バージョン: 1.0" & vbCrLf & vbCrLf & _
          "正常に動作しています。" & vbCrLf & vbCrLf & _
          "メイン機能を起動するには、" & vbCrLf & _
          "「PdfExport_起動」を実行してください。"
    
    MsgBox msg, vbInformation, "PDF/Excel出力アドイン - 動作確認"
End Sub
```
- Alt+F8のマクロ一覧に表示される
- アドインが正常に動作しているか確認できる

### 2. `ThisWorkbook`モジュール（既存または新規作成）

**目的：** アドイン読み込み時・終了時にショートカットキーを設定/解除

**追加内容：**

#### ① Workbook_Open イベント
```vba
Private Sub Workbook_Open()
    ' ショートカットキーの設定
    ' Ctrl+Shift+P でPDF/Excel出力フォームを起動
    On Error Resume Next
    Application.OnKey "^+P", "'PdfExport.xlam'!PdfExport_起動"
    On Error GoTo 0
End Sub
```
- アドイン読み込み時に自動実行
- Ctrl+Shift+P で`PdfExport_起動`を実行できるように設定

#### ② Workbook_BeforeClose イベント
```vba
Private Sub Workbook_BeforeClose(Cancel As Boolean)
    ' ショートカットキーの解除（必須：他アドインとの競合を防ぐ）
    On Error Resume Next
    Application.OnKey "^+P"  ' 引数なしで解除
    On Error GoTo 0
End Sub
```
- アドイン終了時に自動実行
- ショートカットキーを解除（他アドインとの競合を防ぐ）

### 3. 既存モジュールの確認

#### `modPdfExport`モジュール
- ✅ `Option Private Module`は存在しない（確認済み）
- ✅ 既存コードは変更不要
- ✅ `PDF_エクスポート_フォーム表示()`はそのまま使用

## 使用方法

### Alt+F8から実行

1. **Alt+F8**を押してマクロ一覧を開く
2. 以下のマクロが表示されます：
   - `PdfExport_起動` - メイン機能を起動
   - `PdfExport_テスト` - 動作確認用
   - `PE` - QAT用の短い名前版

3. マクロを選択して「実行」をクリック

### ショートカットキーから実行

- **Ctrl+Shift+P** を押すと`PdfExport_起動`が実行されます
- アドイン読み込み時に自動設定されます

### QAT（クイックアクセスツールバー）に登録

1. **Alt+F8**を押してマクロ一覧を開く
2. `PE`を選択
3. 「オプション」をクリック
4. ショートカットキーを設定（例：Ctrl+Shift+E）
5. QATに追加

### 他ブックから呼び出す場合

```vba
' Application.Runを使用
Application.Run "'PdfExport.xlam'!PdfExport_起動"
```

## ファイル構成

```
PdfExport.xlam
├── modEntry          （新規）エントリーポイント
├── modPdfExport      （既存）メイン機能
├── frmPdfExport      （既存）ユーザーフォーム
└── ThisWorkbook      （新規または既存）イベントハンドラ
```

## 注意事項

1. **ショートカットキーの競合**
   - Ctrl+Shift+P が既に他のアドインで使用されている場合は、`ThisWorkbook`の`Workbook_Open`で変更してください
   - 例：`Application.OnKey "^+E", "'PdfExport.xlam'!PdfExport_起動"`（Ctrl+Shift+E）

2. **アドイン名の確認**
   - `ThisWorkbook`の`Workbook_Open`で使用しているアドイン名（`'PdfExport.xlam'`）が実際のファイル名と一致しているか確認してください

3. **マクロ一覧に表示されない場合**
   - アドインが有効化されているか確認
   - VBAエディタで「デバッグ」→「コンパイル」を実行してエラーがないか確認
   - モジュールに`Option Private Module`が付いていないか確認

## 実装手順

1. **modEntryモジュールの追加**
   - VBAエディタで「挿入」→「標準モジュール」
   - モジュール名を`modEntry`に変更
   - `modEntry.txt`の内容をコピー＆ペースト

2. **ThisWorkbookモジュールの確認・追加**
   - VBAエディタで`ThisWorkbook`を開く（存在しない場合は作成）
   - `ThisWorkbook.txt`の内容をコピー＆ペースト
   - 既存のコードがある場合は、イベントハンドラのみ追加

3. **動作確認**
   - Alt+F8でマクロ一覧を確認
   - `PdfExport_テスト`を実行して動作確認
   - `PdfExport_起動`を実行してフォームが表示されるか確認
   - Ctrl+Shift+Pでショートカットキーが動作するか確認

